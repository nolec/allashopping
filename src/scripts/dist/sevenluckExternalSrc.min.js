var sevenluckExternalSrcApp = {
    updateLastPageScrollY: function () {
        var currentScrollY = window.scrollY;
        var path = app.$router.currentRoute.path.replace('/', '').toLowerCase();
        switch (path) {
            case '':
            case 'home':
                app.last_home_scroll_y = currentScrollY;
                break;
        }
    },
    getLastPageScrollY: function (path) {
        path = path.replace('/', '').toLowerCase();
        var lastScrollY = 0;
        switch (path) {
            case '':
            case 'home':
                lastScrollY = app.last_home_scroll_y;
                break;
            default:
                //console.log('#getLastPageScrollY - out of case: ' + path);
                break;
        }
        return lastScrollY;
    },
    redirect: function (name, path, params, query) {
        app.page_redirect_count++;
        app.updateLastPageScrollY();
        if (name && !path)
            path = name;
        LazyRouting.RedirectTo(name, path, params, query);
    },
    show_notify: function (_title, _message, _type) {
        var _icon = "";
        var _delay = 500;

        switch (_type) {
            case "success":
                _icon = 'fas fa-check';
                break;
            case "danger":
                _icon = 'fas fa-exclamation-triangle';
                _delay = 5000;
                break;
            case "info":
                _icon = 'fas fa-info-circle';
                break;
            case "warning":
                _icon = 'far fa-question-circle';
                _delay = 5000;
                break;
        }

        $.notify({ message: _message }, {
            animate: {
                enter: "animated fadeInDown",
                exit: "animated fadeOutUp"
            }
            , type: _type
            , delay: _delay
        }
        );
    },
    loadAuthTicketAndSig: function (app) {
        try {
            if (app.ticket_id != null && app.sig != null) {
            }
            else {
                var targetStorage = 'localStorage';
                app.ticket_id = krjsUtil.getBrowserStorageData(targetStorage, 'num_auth_ticket_id');
                app.sig = krjsUtil.getBrowserStorageData(targetStorage, 'num_auth_ticket_sig');
                if (app.ticket_id === null || app.ticket_id === undefined || app.ticket_id.toLowerCase() === 'undefined' || app.ticket_id.toLowerCase() === 'null')
                    app.ticket_id = null;
                if (app.sig === null || app.sig === undefined || app.sig.toLowerCase() === 'undefined' || app.sig.toLowerCase() === 'null')
                    app.sig = null;
            }
        }
        catch (e) {
            console.error(e);
            app.notifyTestError(e);
        }
    },
    clearAuthTicket: function () {
        app.saveAuthTicketAndSig(null, null);
    },
    saveAuthTicketAndSig: function (ticketId, sig) {
        try {
            app.ticket_id = ticketId;
            app.sig = sig;
            var targetStorage = 'localStorage';
            krjsUtil.writeBrowserStorageData(targetStorage, 'num_auth_ticket_id', ticketId);
            krjsUtil.writeBrowserStorageData(targetStorage, 'num_auth_ticket_sig', sig);
        }
        catch (e) {
            console.error(e);
            console.warn('cannot use browser stoarge');
            app.notifyTestError(e);
        }
    },
    getAuthTicket: function () {
        var targetValue = null;
        try {
            if (app.ticket_id != null) {
                targetValue = app.ticket_id;
            }
            else {
                var targetStorage = 'localStorage';
                targetValue = krjsUtil.getBrowserStorageData(targetStorage, 'num_auth_ticket_id');
                if (targetValue === null || targetValue === undefined || targetValue.toLowerCase() === 'undefined' || targetValue.toLowerCase() === 'null')
                    targetValue = null;
                app.ticket_id = targetValue;
            }
        }
        catch (e) {
            console.error(e);
            console.warn('cannot use browser stoarge');
            app.notifyTestError(e);
        }
        return targetValue;
    },
    getAuthSig: function () {
        var targetValue = null;
        try {
            if (app.sig != null) {
                targetValue = app.sig;
            }
            else {
                var targetStorage = 'localStorage';
                targetValue = krjsUtil.getBrowserStorageData(targetStorage, 'num_auth_ticket_sig');
                if (targetValue === null || targetValue === undefined || targetValue.toLowerCase() === 'undefined' || targetValue.toLowerCase() === 'null')
                    targetValue = null;
                app.sig = targetValue;
            }
        }
        catch (e) {
            console.error(e);
            app.notifyTestError(e);
        }
        return targetValue;
    },
    mainMenu: function (main_menu) {
        app.active_main_menu = main_menu;
        app.active_sub_menu = null;

        switch (main_menu) {
            case '7LuckyDraw':
                app.updateLuckyDrawCategory('');
                app.updateLuckyDrawProductId('');
                app.redirect("/7LuckyDraw");
                break;
            case 'Game Center':
                app.redirect("/GameCenter");
                break;
            case 'Review':
                app.redirect("/Review");
                break;
            case 'Contact':
                app.redirect("/Contact");
                break;
        }
    },
    home: function () {
        app.active_main_menu = 'Home';
        app.active_sub_menu = null;

        // reset cache
        app.last_home_scroll_y = 0;
        app.redirect("/home");
    },
    sevenLuckCraft: function (_menu) {
        if (app.getUserAccountName() !== null) {
            if (app.getAuthTicket() !== null) {
                if (app.getAuthSig() !== null) {
                    app.active_main_menu = '7LuckCraft';
                    app.active_sub_menu = _menu;
                    app.redirect('/7LuckCraft');
                }
                else {
                    app.signingTicket().then(x => {
                        if (x) {
                            app.active_main_menu = '7LuckCraft';
                            app.active_sub_menu = _menu;
                            app.redirect('/7LuckCraft');
                        }
                    });
                }
            }
            else {
                app.signingTicket().then(x => {
                    if (x) {
                        app.active_main_menu = '7LuckCraft';
                        app.active_sub_menu = _menu;
                        app.redirect('/7LuckCraft');
                    }
                });
            }
        }
        else {
            app.show_notify('', 'please scatter login', 'warning');
        }
    },
    siteMapMenu: function (_main, _sub) {
        app.active_main_menu = _main;
        app.active_sub_menu = _sub;
        app.redirect("/" + _main);
    },
    reset_init_button: function (app) {
        app.isInitializing = false;
    },
    update_init_button: function (app) {
        app.isInitializing = true;
    },
    getUserAccountName: function () {
        if (app.account != null) {
            return app.account.name;
        }
        else if (app.getLuckyDrawUserId() != null) {
            // load from session storage
            return app.getLuckyDrawUserId();
        }
        return null;
    },
    init_scatter: function (app, isUserAction) {
        app.isInitByUser = isUserAction;
        if (app.isInitializing === true) {
            console.log('already initializing..');
            return;
        }
        app.update_init_button(app);

        qv.get('/api/chain/id')
            .then(x => {
                app.chainId = x.data;
                app.network = {
                    blockchain: 'eos',
                    protocol: 'https',
                    port: 443,
                    //host: 'api.kylin.alohaeos.com',
                    //host: 'jungle2.cryptolions.io',
                    host: 'proxy.eosnode.tools',
                    debug: true,
                    chainId: app.chainId
                };
                numHttpEos.isMainNet = true;
                numHttpEos.isKylin = false;
                var appName = '7Luck';
                num21eos.init(appName, app.network, false, true, function () {
                    app.account = num21eos.account;
                    app.requiredFields = { accounts: [app.network] };
                    app.reset_init_button(app);
                    app.start_interval();
                    app.checkUserExist();
                    app.updateLuckyDrawUserId(app.account.name);

                    try {
                        setTimeout(function () {
                            app.changeLanguage(app.curr_language);
                        }, 200);
                    }
                    catch (e) {
                        console.error(e);
                    }
                }, function (msg) {
                    var isExpected = false;
                    if (msg) {
                        var lower = msg.toLowerCase();
                        if (lower.includes('lock') || lower.includes('unlock')) {
                            isExpected = true;
                            if (app.isInitByUser === true) {
                                //console.log('#num21eos.scatterType: ' + num21eos.scatterType);
                                if (num21eos.scatterType !== 'extension')
                                    app.show_notify($.i18n.t('alert:alert_title_failed'), $.i18n.t('alert:alert_scatter_locked'), 'danger');
                                else {
                                    //nothing for scatter desktop
                                }
                            }
                        }
                        else if (lower.includes('user reject')) {
                            isExpected = true;
                            // 유저가 취소한거라 안보여줘도..
                            //app.show_notify('Scatter 초기화 실패', '사용자가 인증을 취소했습니다.', 'danger');
                        }
                        else if (lower.includes('desktop is not loaded')) {
                            isExpected = true;
                            if (app.isInitByUser === true) {
                                if (krjsUtil.checkDeviceTypeMobile() === true) {
                                    app.show_notify($.i18n.t('alert:alert_title_failed'), $.i18n.t('alert:alert_scatter_not_found'), 'danger');
                                }
                                else {
                                    //app.show_notify('Scatter를 찾을 수 없습니다', '<a href="https://github.com/GetScatter/ScatterDesktop/releases"> Scatter 설치 링크</a><br/><br/> 위 링크를 통해 Scatter 설치 이후 다시 시도해 주시기 바랍니다.', 'danger');
                                    app.show_notify($.i18n.t('alert:alert_title_failed'), $.i18n.t('alert:alert_scatter_not_found'), 'danger');
                                }
                            }
                            else
                                console.log('auto connect failed');
                        }
                        else if (lower.includes('user did not allow')) {
                            //The user did not allow this app to connect to their Scatter
                            isExpected = true;
                        }
                    }
                    if (isExpected === false) {
                        app.show_notify($.i18n.t('alert:alert_scatter_init_failed'), msg, 'danger');
                    }
                    app.reset_init_button();
                    console.log('on_scatter_error: ' + msg);
                });
            }).catch(err => {
                app.reset_init_button();
                app.show_notify($.i18n.t('alert:alert_scatter_init_failed'), err, 'danger');
                console.error(err);
            });
    },
    forget_identity: function () {
        try {
            //if (confirm($.i18n.t('alert:alert_scatter_disconnect'))) {
            app.clearAuthTicket();
            app.clearWebStorage();
            num21eos.sco.forgetIdentity({ accounts: [app.network] })
                .then(() => {
                    app.requiredFields = null;
                    app.eos = null;
                    app.network = null;
                    app.account = null;
                    app.chainId = null;
                })
                .catch(err => {
                    console.error(err);
                });
            // required for reset scatter
            location.reload();
            if (app.is_run_on_app === true)
                app.notifyLogoutToApp();
            //}
        }
        catch (e) {
            console.error(e);
        }
    },
    start_interval: function () {
        try {
            setTimeout(function () {
                app.getBalance();
            }, 1000);

            app.auto_interval = setInterval(function () {
                app.getBalance();
            }, 10000);
        }
        catch (e) {
            console.error(e);
        }
    },
    getBalance: function () {
        try {
            if (app.getUserAccountName()) {
                num21eos.eso.getCurrencyBalance('eosio.token', app.getUserAccountName(), 'EOS').then(x => {
                    app.balances = x.toString();
                });
            }
        }
        catch (e) {
            console.error(e);
        }
    },
    showLanguage: function () {
        $('.language-view').addClass("language-view-on");
    },
    hideLanguage: function () {
        $('.language-view').removeClass("language-view-on");
    },
    loadLanguageData: function (app) {
        $.getJSON('../localize/' + app.localize_file_name, function (data) {
            app.localize_data = JSON.stringify(data);
            app.initLanguage();
        });
    },
    initLanguage: function () {
        var savedLocale = app.getLuckyDrawLocale();
        if (savedLocale)
            app.curr_language = savedLocale;
        $.i18n.init({
            lng: app.curr_language,
            debug: false,
            useLocalStorage: false,
            localStorageExpirationTime: 86400000, // in ms, default 1 week
            ns: {
                namespaces: ['home', 'luckydraw', 'review', 'contact', 'sevenluck', 'modal', 'alert'],
                defaultNs: 'home'
            },
            resStore: $.parseJSON(app.localize_data)
        }, function () {
            $('body').i18n();
        });
    },
    changeLanguage: function (_lang) {
        app.updateLuckyDrawLocale(_lang);
        app.curr_language = _lang;
        $.i18n.setLng(_lang);
        $('body').i18n();
        $('.language-view').removeClass("language-view-on");
    },
    convertTime: function Time(time) {
        var u = new Date(time * 1000);
        return u.getFullYear() +
            '-' + ('0' + ((u.getMonth()) + 1)).slice(-2) +
            '-' + ('0' + u.getDate()).slice(-2) +
            ' ' + ('0' + u.getHours()).slice(-2) +
            ':' + ('0' + u.getMinutes()).slice(-2) +
            ':' + ('0' + u.getSeconds()).slice(-2)
        //+ '.' + (u.getMilliseconds() / 1000).toFixed(3).slice(2, 5)
    },
    checkUserExist: function () {
        return qv.get('/api/chain/CheckUserExist/' + app.getUserAccountName(), {}).then(x => {
            try {
                if (x.returnCode === 0) {
                    if (x.referrer_id && x.referrer_id.length > 0)
                        app.referrer_id = x.referrer_id;
                    else
                        app.referrer_id = null;

                    app.is_referrer_checked = true;
                    app.check_id = x.user_id;

                    if (x.user_id == null) {
                        app.showRegCode();
                    }
                    return true;
                }
                else {
                    return false;
                }
            }
            catch (e) {
                console.error(e);
            }
            return false;
        });
    },
    showRegCode: function () {
        $('#modal-refferal').modal({
            backdrop: 'static',
            keyboard: false  // to prevent closing with Esc button (if you want this too)
        });
        $('#modal-refferal').modal('show');
    },
    regCode: function () {
        if (app.getUserAccountName() == null) {
            app.show_notify('', $.i18n.t('alert:alert_scatter_login'), 'danger');
        }
        else {
            app.signingTicket().then(x => {
                if (x) {
                    app.check_id = app.getUserAccountName();
                } else {
                    app.referrer_id = null;
                }
                $('#modal-refferal').modal('hide');
            })
        }
    },
    noneRegCode: function () {
        if (app.getUserAccountName() == null) {
            app.show_notify('', $.i18n.t('alert:alert_scatter_login'), 'danger');
        }
        else {
            app.referrer_id = null;
            app.signingTicket().then(x => {
                if (x) {
                    app.check_id = app.getUserAccountName();
                }
                $('#modal-refferal').modal('hide');
            });
        }
    },
    signingTicket: function () {
        return app.generateTicket().then(x => {
            if (x) {
                return app.validateTicket().then(y => {
                    return y;
                })
            }
            else {
                return x;
            }
        });
    },
    generateTicket: function () {
        return qv.get('/api/chain/GenerateTicket/' + app.getUserAccountName(), {}).then(x => {
            if (x.returnCode === 0) {
                app.saveAuthTicketAndSig(x.ticketId, null);
                return true;
            }
            else {
                app.clearAuthTicket();
                app.show_notify('', x.description, 'danger');
                return false;
            }
        });
    },

    validateTicket: function () {
        app.is_waiting_signature = true;
        return num21eos.requestArbitrarySignatureForTicket('luckydraw', app.getAuthTicket()).then(result => {
            app.is_waiting_signature = false;
            if (result) {
                var formData = new FormData();
                formData.append('requestData', 'luckydraw');
                formData.append('userId', app.getUserAccountName());
                formData.append('publicKey', result.publicKey);
                formData.append('sig', result.sig);
                if (app.getAuthTicket())
                    formData.append('ticketId', app.getAuthTicket());

                if (app.referrer_id && app.referrer_id.length > 0)
                    formData.append('referrerId', app.referrer_id);

                return qv.postForm('/api/chain/ValidateTicket', formData).then(x => {
                    if (x.returnCode === 0) {
                        app.sig = result.sig;
                        app.saveAuthTicketAndSig(app.getAuthTicket(), result.sig);
                        return true;
                    }
                    else {
                        app.clearAuthTicket();
                        //alert(x.description);
                        // need to add message: session expired
                        location.reload();

                        return false;
                    }
                });
            }
            else {
                return false;
            }
        });
    },
    checkTicket: function () {
        try {
            if (app.getUserAccountName() == null) {
                app.show_notify('', $.i18n.t('alert:alert_scatter_login'), 'danger');
            }
            else if (app.getAuthSig() == null) {
                console.log('checkTicket: sig not exists');
            }
            else if (app.getAuthTicket() == null) {
                console.log('checkTicket: auth ticket not exists');
            }
            else {
                var formData = new FormData();
                formData.append('requestData', 'luckydraw');
                formData.append('userId', app.getUserAccountName());
                formData.append('sig', app.getAuthSig());
                if (app.getAuthTicket())
                    formData.append('ticketId', app.getAuthTicket());

                return qv.postForm('/api/chain/CheckTicket', formData).then(x => {
                    if (x.returnCode === 0) {
                        return true;
                    }
                    else {
                        app.clearAuthTicket();
                        if (app.is_referrer_checked) {
                            return app.signingTicket().then(t => {
                                return t;
                            })
                        } else {
                            return false;
                        }
                    }
                });
            }
        }
        catch (e) {
            console.error(e);
            app.notifyTestError(e);
        }
        return new Promise(function (resolve, reject) {
            resolve(false);
        });
    },
    showWinnerInfo: function (_table) {
        try {
            app.winner_info = _table;
            return qv.get('/api/chain/GetBetList/4,5,6/' + _table.product_id + '/' + _table.round_id + '/-/-', {}).then(x => {
                try {
                    app.winner_round_info = x.data.list;
                    $('#modal-winner-info').modal('show');
                    setTimeout(function () {
                        app.changeLanguage(app.curr_language);
                    }, 200);
                }
                catch (e) {
                    console.error(e);
                }
            });
        }
        catch (e) {
            console.error(e);
            app.notifyTestError(e);
        }
        return new Promise(function (resolve, reject) {
            resolve(false);
        });
    },
    showReviewDetail: function (_review_idx) {
        try {
            app.getReviewInfo(_review_idx).then(x => {
                if (x) {
                    $('#modal-review-detail').modal('show');
                    setTimeout(function () {
                        app.changeLanguage(app.curr_language);
                    }, 200);
                }
            });
        }
        catch (e) {
            console.error(e);
            app.notifyTestError(e);
        }
        return new Promise(function (resolve, reject) {
            resolve(false);
        });
    },
    getReviewInfo: function (_review_idx) {
        try {
            var formData = new FormData();
            formData.append('pageNo', '1');
            formData.append('pageSize', '1');
            formData.append('reviewIdx', _review_idx);

            return qv.postForm('/api/chain/GetReviewList', formData).then(data => {
                if (data.list.length > 0) {
                    app.review_detail_info = data.list[0];
                    return true;
                }
                else {
                    return false;
                }
            });
        }
        catch (e) {
            console.error(e);
            app.notifyTestError(e);
        }
        return new Promise(function (resolve, reject) {
            resolve(false);
        });
    },
    showReviewWrite: function (_table) {
        try {
            app.review_write_info = _table;

            var formData = new FormData();
            formData.append('pageNo', '1');
            formData.append('pageSize', '1');
            formData.append('roundId', _table.round_id);

            return qv.postForm('/api/chain/GetReviewList', formData).then(data => {
                if (data.length > 0) {
                    app.review_write_title = data[0].title;
                    app.review_write_content = data[0].content;
                    app.review_write_image_path = data[0].image_path;
                    $("#review_write_img").attr("src", '../../uploads/' + data[0].image_path);
                }
                else {
                    app.review_write_title = null;
                    app.review_write_content = null;
                    app.review_write_image_path = null;
                    app.review_write_file = null;
                    $("#review_write_img").attr("src", '../../images/img_picture_bg.png');
                }
                $('#modal-review-write').modal('show');
            });
        }
        catch (e) {
            console.error(e);
            app.notifyTestError(e);
        }
        return new Promise(function (resolve, reject) {
            resolve(false);
        });
    },
    writeReview: function () {
        try {
            var formData = new FormData();
            formData.append('requestData', 'luckydraw');
            formData.append('userId', app.getUserAccountName());
            formData.append('sig', app.getAuthSig());
            if (app.getAuthTicket())
                formData.append('ticketId', app.getAuthTicket());
            formData.append('roundId', app.review_write_info.round_id);
            formData.append('title', app.review_write_title);
            formData.append('content', app.review_write_content);
            formData.append('imagePath', app.review_write_image_path);
            formData.append('imageFile', app.review_write_file);

            return qv.postForm('/api/chain/WriteReview', formData).then(x => {
                if (x.returnCode === 0) {
                    $('#modal-review-write').modal('hide');
                }
                else {
                    app.show_notify('', x.description, 'danger');
                }
            });
        }
        catch (e) {
            console.error(e);
            app.notifyTestError(e);
        }
        return new Promise(function (resolve, reject) {
            resolve(false);
        });
    },
    clickReviewImg: function () {
        $("#fileReviewImg").click();
    },
    checkImgSize: function (file) {
        var maxSize = 10 * 1024 * 1024;    //1MB
        var fileSize = 0;
        var browser = navigator.appName;

        if (browser == "Microsoft Internet Explorer") {
            var oas = new ActiveXObject("Scripting.FileSystemObject");
            fileSize = oas.getFile(file.value).size;
        }
        else {
            fileSize = file.size;
        }

        if (fileSize > maxSize) {
            app.show_notify('', $.i18n.t('alert:alert_image_size_over'), 'danger');
            return false;
        }
        else
            return true;
    },
    changeReviewImg: function (event) {
        try {
            app.review_write_file = event.target.files[0];

            var regex = /(.jpg|.jpeg|.gif|.png|.bmp)$/;
            if (regex.test(event.target.files[0].type.toLowerCase())) {
                var agent = navigator.userAgent.toLowerCase();
                if (((navigator.appName == 'Netscape' && navigator.userAgent.search('Trident') != -1) || (agent.indexOf("msie") != -1)) && parseFloat(jQuery.browser.version) <= 9.0) {
                    if (app.checkImgSize(event.target.val()))
                        $("#review_write_img").filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = event.target.val();
                }
                else {
                    if (typeof (FileReader) !== "undefined") {
                        if (app.checkImgSize(event.target.files[0])) {
                            $("#review_write_img").show();

                            var reader = new FileReader();
                            reader.onload = function (e) {
                                $("#review_write_img").attr("src", e.target.result);
                            };
                            reader.readAsDataURL(event.target.files[0]);
                        }
                    } else {
                        app.show_notify('', 'This browser does not support FileReader.', 'danger');
                    }
                }
            } else {
                app.show_notify('', 'Please upload a valid image file.', 'danger');
            }
        }
        catch (e) {
            console.error(e);
            app.notifyTestError(e);
        }
    },
    showSliderH: function () {
        try {
            setTimeout(function () {
                $('.slider-h').slick({
                    //vertical: true,
                    horizontal: true,
                    autoplay: true,
                    autoplaySpeed: 4000,
                    speed: 700,
                    arrows: false
                });
            }, 200);
        }
        catch (e) {
            console.error('failed on slick control');
            console.error(e);
        }
    },
    showExternalLink: function (externalLink) {
        try {
            if (app.is_run_on_app === true) {
                try {
                    var postMsg = {
                        'type': 'openUrl',
                        'message': externalLink
                    };
                    if (window.ReactNativeWebView) {
                        // react-native-webview
                        window.ReactNativeWebView.postMessage(JSON.stringify(postMsg));
                    } else {
                        // webview in react native
                        window.postMessage(JSON.stringify(postMsg), "*");
                    }
                }
                catch (e) {
                    console.error(e);
                }
            }
            else {
                window.open(externalLink);
            }
        }
        catch (e) {
            console.error(e);
            app.notifyTestError(e);
        }
    },
    showExternalWebview: function (externalLink) {
        try {
            if (app.is_run_on_app === true) {
                try {
                    var postMsg = {
                        'type': 'openWebview',
                        'message': externalLink
                    };
                    if (window.ReactNativeWebView) {
                        // react-native-webview
                        window.ReactNativeWebView.postMessage(JSON.stringify(postMsg));
                    } else {
                        // webview in react native
                        window.postMessage(JSON.stringify(postMsg), "*");
                    }
                }
                catch (e) {
                    console.error(e);
                }
            }
            else {
                window.open(externalLink);
            }
        }
        catch (e) {
            console.error(e);
            app.notifyTestError(e);
        }
    },
    showBlockExplore: function (accountName, link) {
        if (link === null || link === undefined)
            link = 'https://eospark.com/account/';
        app.showExternalWebview(link + accountName);
    },
    notifyTestError: function (e) {
        try {
            var message = '';
            if (typeof e === 'string')
                message = e;
            else if (typeof e === 'object')
                message = JSON.stringify(e);
            app.show_notify('', message, 'danger');
        }
        catch (e) {
            console.error(e);
        }
    },
    notifyAlarmToApp: function (type) {
        try {
            if (app.is_run_on_app === true) {
                var postMsg = {
                    'type': 'alarm',
                    'message': type
                };
                if (window.ReactNativeWebView) {
                    window.ReactNativeWebView.postMessage(JSON.stringify(postMsg));
                } else {
                    window.postMessage(JSON.stringify(postMsg), "*");
                }
            }
        }
        catch (e) {
            console.error(e);
            app.notifyTestError(e);
        }
    },
    notifyLogoutToApp: function () {
        try {
            if (app.is_run_on_app === true) {
                var postMsg = {
                    'type': 'logout',
                    'message': 'logout'
                };
                if (window.ReactNativeWebView) {
                    window.ReactNativeWebView.postMessage(JSON.stringify(postMsg));
                } else {
                    window.postMessage(JSON.stringify(postMsg), "*");
                }
            }
        }
        catch (e) {
            console.error(e);
        }
    },
    callFromApp: function () {
        try {
            app.is_run_on_app = true;
        }
        catch (e) {
            console.error(e);
        }
    },
    clearWebStorage: function () {
        app.updateLuckyDrawUserId(null);
    },
    testWriteLocalStorage: function () {
        app.notifyTestError('arbitrarySignature request');

        app.notifyTestError('arbitrarySignature request');
        app.is_waiting_signature = true;
        num21eos.requestArbitrarySignatureForTicket('luckydraw', 'temp').then(result => {
            app.is_waiting_signature = false;
            app.notifyTestError('arbitrarySignature success');
        });
    },
    updateLuckyDrawCategory: function (category) {
        krjsUtil.writeBrowserStorageData('localStorage', '7luck_luckydraw_category', category);
    },
    getLuckyDrawCategory: function () {
        return krjsUtil.getBrowserStorageData('localStorage', '7luck_luckydraw_category');
    },
    updateLuckyDrawProductId: function (productId) {
        krjsUtil.writeBrowserStorageData('localStorage', '7luck_luckydraw_product_id', productId);
    },
    getLuckyDrawProductId: function () {
        return krjsUtil.getBrowserStorageData('localStorage', '7luck_luckydraw_product_id');
    },
    updateLuckyDrawLocale: function (locale) {
        krjsUtil.writeBrowserStorageData('localStorage', '7luck_luckydraw_locale', locale);
    },
    getLuckyDrawLocale: function () {
        return krjsUtil.getBrowserStorageData('localStorage', '7luck_luckydraw_locale');
    },

    updateLuckyDrawUserId: function (userId) {
        krjsUtil.writeBrowserStorageData('sessionStorage', '7luck_luckydraw_user_id', userId);
    },
    getLuckyDrawUserId: function () {
        return krjsUtil.getBrowserStorageData('sessionStorage', '7luck_luckydraw_user_id');
    },
    pageBack: function () {
        if (app.page_redirect_count > 0)
            router.go(-1);
        else {
            // 새로고침해서 정보 없을 경우만 기본 함수 사용해서 홈으로 이동
            app.page_redirect_count = 0;
            var name = '/home';
            LazyRouting.RedirectTo(name, name);
        }
    },
};